<div class="dashboard-container">
  <div class="page-header">
    <div class="header-content">
      <h1>Dashboard Overview</h1>
      <p>Welcome back, Admin! Here's what's happening with RevTicket today.</p>
    </div>
    <div class="header-actions">
      <button class="btn-secondary" (click)="refreshData()" [disabled]="loading()">
        <span class="icon">ğŸ”„</span>
        {{ loading() ? 'Loading...' : 'Refresh' }}
      </button>
    </div>
  </div>

  @if (!loading()) {
    <div class="stats-grid">
    <div class="stat-card revenue">
      <div class="stat-icon">ğŸ’°</div>
      <div class="stat-content">
        <h3 class="stat-value">{{ formatCurrency(stats().totalRevenue) }}</h3>
        <p class="stat-label">Total Revenue</p>
        <div class="stat-change" [class.positive]="getRevenueChange().isPositive"
          [class.negative]="!getRevenueChange().isPositive">
          <span class="change-icon">{{ getRevenueChange().isPositive ? 'ğŸ“ˆ' : 'ğŸ“‰' }}</span>
          <span class="change-text">{{ getRevenueChange().isPositive ? '+' : '-' }}{{ getRevenueChange().value |
            number:'1.1-1' }}% from last period</span>
        </div>
      </div>
    </div>

    <div class="stat-card bookings">
      <div class="stat-icon">ğŸ«</div>
      <div class="stat-content">
        <h3 class="stat-value">{{ stats().totalBookings }}</h3>
        <p class="stat-label">Total Bookings</p>
        <div class="stat-change" [class.positive]="getBookingsChange().isPositive">
          <span class="change-icon">ğŸ“ˆ</span>
          <span class="change-text">+{{ getBookingsChange().value }}% from last week</span>
        </div>
      </div>
    </div>

    <div class="stat-card movies">
      <div class="stat-icon">ğŸ¬</div>
      <div class="stat-content">
        <h3 class="stat-value">{{ stats().activeMovies }}</h3>
        <p class="stat-label">Active Movies</p>
        <div class="stat-change neutral">
          <span class="change-icon">â¡ï¸</span>
          <span class="change-text">Out of {{ stats().totalMovies }} total</span>
        </div>
      </div>
    </div>

    <div class="stat-card users">
      <div class="stat-icon">ğŸ‘¥</div>
      <div class="stat-content">
        <h3 class="stat-value">{{ stats().totalUsers }}</h3>
        <p class="stat-label">Total Users</p>
        <div class="stat-change" [class.positive]="getUsersChange().isPositive">
          <span class="change-icon">ğŸ“ˆ</span>
          <span class="change-text">+{{ getUsersChange().value }}% new users</span>
        </div>
      </div>
    </div>
    </div>
  }

  @if (loading()) {
    <div class="loading-state">
    <div class="spinner"></div>
      <p>Loading dashboard data...</p>
    </div>
  }

  @if (!loading()) {
    <div class="dashboard-grid">
    <div class="chart-section">
      <div class="section-card">
        <div class="card-header">
          <h3 class="card-title">Revenue Analytics</h3>
          <div class="card-actions">
            <button class="filter-btn" [class.active]="selectedPeriod() === 7" (click)="onPeriodChange(7)">
              7D
            </button>
            <!-- <button 
              class="filter-btn" 
              [class.active]="selectedPeriod === 30"
              (click)="onPeriodChange(30)">
              30D
            </button>
            <button 
              class="filter-btn" 
              [class.active]="selectedPeriod === 90"
              (click)="onPeriodChange(90)">
              90D
            </button> -->
          </div>
        </div>
        <div class="chart-placeholder">
          @if (revenueData().length > 0) {
            <div class="chart-bars">
              @for (data of revenueData(); track data.date) {
                <div class="bar" [style.height]="getBarHeight(data.revenue)"
                  [title]="formatCurrency(data.revenue)">
                </div>
              }
            </div>
          } @else {
            <div class="chart-empty">
              <p>No revenue data available</p>
            </div>
          }
          @if (revenueData().length > 0) {
            <div class="chart-labels">
              @for (data of revenueData(); track data.date) {
                <span>{{ data.date | date:'EEE' }}</span>
              }
            </div>
          }
          <p class="chart-label">Daily Revenue Trend</p>
        </div>
      </div>
    </div>

    <div class="quick-actions">
      <div class="section-card">
        <div class="card-header">
          <h3 class="card-title">Quick Actions</h3>
        </div>
        <div class="actions-grid">
          <a routerLink="/admin/add-movie" class="quick-action-btn">
            <div class="action-icon">ğŸ¬</div>
            <div class="action-content">
              <h4>Add Movie</h4>
              <p>Add new movie to catalog</p>
            </div>
          </a>
          <a routerLink="/admin/manage-shows" class="quick-action-btn">
            <div class="action-icon">ğŸ“…</div>
            <div class="action-content">
              <h4>Manage Shows</h4>
              <p>Schedule new showtimes</p>
            </div>
          </a>
          <a routerLink="/admin/manage-theatres" class="quick-action-btn">
            <div class="action-icon">ğŸ¢</div>
            <div class="action-content">
              <h4>Add Theatre</h4>
              <p>Register new theatre</p>
            </div>
          </a>
          <a routerLink="/admin/bookings-report" class="quick-action-btn">
            <div class="action-icon">ğŸ“Š</div>
            <div class="action-content">
              <h4>View Reports</h4>
              <p>Booking analytics</p>
            </div>
          </a>
        </div>
      </div>
    </div>
    </div>
  }

  @if (!loading()) {
    <div class="recent-activity">
      <div class="section-card">
      <div class="card-header">
        <h3 class="card-title">Recent Activity</h3>
        <button class="view-all-btn" (click)="loadRecentActivities()">Refresh</button>
      </div>
      @if (recentActivities().length > 0) {
        <div class="activity-list">
          @for (activity of recentActivities(); track activity.timestamp) {
            <div class="activity-item">
              <div class="activity-icon" [class]="activity.type">
                @switch (activity.type) {
                  @case ('booking') { <span>ğŸ«</span> }
                  @case ('movie') { <span>ğŸ¬</span> }
                  @case ('user') { <span>ğŸ‘¤</span> }
                  @case ('theater') { <span>ğŸ¢</span> }
                }
              </div>
              <div class="activity-content">
                <p class="activity-text" [innerHTML]="activity.message"></p>
                <span class="activity-time">{{ getTimeAgo(activity.timestamp) }}</span>
              </div>
            </div>
          }
        </div>
      } @else {
        <div class="empty-activity">
          <p>No recent activity</p>
        </div>
      }
      </div>
    </div>
  }
</div>