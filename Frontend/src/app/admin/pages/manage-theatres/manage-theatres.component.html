<div class="manage-theatres-page">
  <!-- Header -->
  <header class="page-header">
    <div class="header-left">
      <h1 class="page-title">Manage Theatres</h1>
      <p class="page-subtitle">View and manage all theatres in your system</p>
    </div>
    <div class="header-actions">
      <button class="btn-primary" (click)="addTheatre()">
        <span>+</span>
        <span>Add Theatre</span>
      </button>
    </div>
  </header>

  <!-- Filters Section -->
  <section class="filters-section">
    <div class="search-box">
      <span class="search-icon">ğŸ”</span>
      <input type="text" placeholder="Search theatres..." [value]="searchTerm()"
        (input)="onSearchChange($any($event).target.value)">
    </div>

    <select [value]="selectedCity()" (change)="onCityChange($any($event).target.value)" class="filter-select">
      <option value="">All Cities</option>
      @for (city of cities(); track $index) {
      <option [value]="city">{{ city }}</option>
      }
    </select>

    <select [value]="selectedStatus()" (change)="onStatusChange($any($event).target.value)" class="filter-select">
      <option value="">All Status</option>
      <option value="active">Active</option>
      <option value="inactive">Inactive</option>
    </select>
  </section>

  <!-- Add/Edit Form Modal -->
  @if (showForm()) {
  <div class="form-overlay" (click)="cancelForm()"></div>
  <div class="form-modal" (click)="$event.stopPropagation()">
    <div class="form-header">
      <h3>{{ editingTheatreId() ? 'Edit Theatre' : 'Add New Theatre' }}</h3>
      <button type="button" class="close-btn" (click)="cancelForm()">Ã—</button>
    </div>

    <form [formGroup]="theatreForm" (ngSubmit)="submitTheatre()" class="theatre-form">
      <div class="form-row">
        <div class="form-group" [class.invalid]="isInvalid('name')">
          <label for="name">Theatre Name *</label>
          <input type="text" id="name" formControlName="name" class="form-control" placeholder="e.g., PVR Icon">
          @if (isInvalid('name')) {
          <small class="form-error">Name is required (max 120 characters)</small>
          }
        </div>

        <div class="form-group" [class.invalid]="isInvalid('location')">
          <label for="location">City / Location *</label>
          <input type="text" id="location" formControlName="location" class="form-control"
            placeholder="e.g., Mumbai, Delhi">
          @if (isInvalid('location')) {
          <small class="form-error">Location is required</small>
          }
        </div>
      </div>

      <div class="form-group" [class.invalid]="isInvalid('address')">
        <label for="address">Address *</label>
        <textarea id="address" formControlName="address" class="form-control" rows="3"
          placeholder="Full address of the theatre"></textarea>
        @if (isInvalid('address')) {
        <small class="form-error">Address is required</small>
        }
      </div>

      <div class="form-row">
        <div class="form-group" [class.invalid]="isInvalid('totalScreens')">
          <label for="totalScreens">Total Screens *</label>
          <input type="number" id="totalScreens" formControlName="totalScreens" class="form-control" min="1">
          @if (isInvalid('totalScreens')) {
          <small class="form-error">Provide at least one screen</small>
          }
        </div>

        <div class="form-group" [class.invalid]="isInvalid('imageUrl')">
          <label for="imageUrl">Image URL</label>
          <input type="url" id="imageUrl" formControlName="imageUrl" class="form-control" placeholder="https://...">
        </div>
      </div>

      <div class="form-group">
        <label for="isActive">Status</label>
        <select id="isActive" formControlName="isActive" class="form-control">
          <option [ngValue]="true">Active</option>
          <option [ngValue]="false">Inactive</option>
        </select>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-secondary" (click)="cancelForm()" [disabled]="submitting()">
          Cancel
        </button>
        <button type="submit" class="btn-primary" [disabled]="theatreForm.invalid || submitting()">
          {{ submitting() ? 'Saving...' : (editingTheatreId() ? 'Update Theatre' : 'Add Theatre') }}
        </button>
      </div>
    </form>
  </div>
  }

  <!-- Loading State -->
  @if (loading()) {
  <div class="loading-state">
    <div class="spinner"></div>
    <p>Loading theatres...</p>
  </div>
  }

  <!-- Theatres List -->
  @if (!loading() && filteredTheatres().length > 0) {
  <div class="theatres-table">
    <!-- Table Header -->
    <div class="table-header">
      <div class="col-name">Theatre Name</div>
      <div class="col-location">City / Location</div>
      <div class="col-screens">Screens</div>
      <div class="col-status">Status</div>
      <div class="col-actions">Actions</div>
    </div>

    <!-- Table Rows -->
    @for (theatre of filteredTheatres(); track trackByTheatreId($index, theatre)) {
    <div class="table-row">
      <div class="col-name">
        <div class="theatre-title">{{ theatre.name }}</div>
        <div class="theatre-address">{{ theatre.address }}</div>
      </div>

      <div class="col-location">{{ theatre.location }}</div>

      <div class="col-screens">
        <span class="screen-badge">{{ theatre.totalScreens }} Screens</span>
      </div>

      <div class="col-status">
        <span class="status-pill" [class.active]="theatre.isActive" [class.inactive]="!theatre.isActive">
          {{ theatre.isActive ? 'â— Active' : 'â— Inactive' }}
        </span>
      </div>

      <div class="col-actions">
        <button class="action-btn screens" (click)="viewScreens(theatre.id)" title="View Screens">
          ğŸ¬
        </button>
        <button class="action-btn edit" (click)="editTheatre(theatre)" title="Edit">
          âœï¸
        </button>
        <button class="action-btn toggle" (click)="toggleStatus(theatre)" [disabled]="statusUpdatingId() === theatre.id"
          [title]="theatre.isActive ? 'Deactivate' : 'Activate'">
          {{ theatre.isActive ? 'ğŸš«' : 'âœ“' }}
        </button>
        <button class="action-btn delete" (click)="deleteTheatre(theatre)" [disabled]="deletingId() === theatre.id"
          title="Delete">
          ğŸ—‘ï¸
        </button>
      </div>
    </div>
    }
  </div>
  }

  <!-- Empty State -->
  @if (!loading() && filteredTheatres().length === 0) {
  <div class="empty-state">
    <div class="empty-icon">ğŸ­</div>
    <h3>No Theatres Found</h3>
    <p>{{ searchTerm() || selectedCity() || selectedStatus() ? 'Try adjusting your filters' : 'Add your first theatre to
      get started' }}</p>
    @if (!searchTerm() && !selectedCity() && !selectedStatus()) {
    <button class="btn-primary" (click)="addTheatre()">
      <span>+</span>
      <span>Add Theatre</span>
    </button>
    }
  </div>
  }
</div>